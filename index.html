<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MINERA CHECKER SELISIH</title>
  <style>
    /* ====== VARIABLES & RESET ====== */
    :root {
      --primary: #1e3a8a;
      --primary-light: #3b82f6;
      --primary-lighter: #60a5fa;
      --secondary: #f8fafc;
      --accent: #0ea5e9;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6; /* Biru muda untuk tampil */
      --text: #1e293b;
      --text-light: #64748b;
      --border: #e2e8f0;
      --card-bg: #ffffff;
      --shadow: 0 10px 25px rgba(30, 58, 138, 0.08);
      --shadow-hover: 0 15px 35px rgba(30, 58, 138, 0.12);
      --radius: 12px;
      --radius-lg: 16px;
      --transition: all 0.3s ease;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #f8fafc 100%);
      color: var(--text);
      min-height: 100vh;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://cdn.areabermain.club/assets/cdn/az9/2025/10/08/20251008/e615919bf7952d738f21af8c12fed553/logo-hokijitu.png');
      background-size: 400px;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.03;
      z-index: -1;
      pointer-events: none;
    }

    /* ====== HEADER & LOGO ====== */
    .header-container {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      padding: 24px 0 32px;
      position: relative;
      overflow: hidden;
      border-bottom-left-radius: 40px;
      border-bottom-right-radius: 40px;
      box-shadow: var(--shadow);
    }

    .header-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: radial-gradient(circle at 20% 80%, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.3;
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 24px;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .logo {
      height: 60px;
      width: auto;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
    }

    .logo-text {
      display: flex;
      flex-direction: column;
    }

    .logo-title {
      font-size: 28px;
      font-weight: 800;
      color: white;
      margin: 0;
      letter-spacing: -0.5px;
    }

    .logo-subtitle {
      font-size: 16px;
      font-weight: 500;
      color: rgba(255,255,255,0.9);
      margin: 0;
    }

    /* ====== MAIN CONTENT ====== */
    .main-container {
      max-width: 1200px;
      margin: -20px auto 40px;
      padding: 0 24px;
      position: relative;
      z-index: 1;
    }

    .intro-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 28px;
      margin-bottom: 30px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.8);
      backdrop-filter: blur(10px);
    }

    .intro-card h1 {
      margin: 0 0 12px;
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .intro-card h1::before {
      content: '';
      display: block;
      width: 8px;
      height: 32px;
      background: linear-gradient(to bottom, var(--primary-light), var(--accent));
      border-radius: 4px;
    }

    .intro-card p {
      margin: 0 0 18px;
      color: var(--text-light);
      line-height: 1.6;
      font-size: 16px;
    }

    .key-info {
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: var(--radius);
      padding: 20px;
      border-left: 4px solid var(--primary-light);
    }

    .key-info p {
      margin: 0;
      color: var(--primary);
      font-weight: 500;
    }

    /* ====== GRID LAYOUT ====== */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      align-items: start;
      margin-bottom: 30px;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    /* ====== CARDS ====== */
    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 28px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.9);
      transition: var(--transition);
      height: 100%;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-4px);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 16px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .card-title {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }

    .card-title::before {
      content: '';
      display: block;
      width: 6px;
      height: 24px;
      background: var(--accent);
      border-radius: 3px;
    }

    /* ====== FORM ELEMENTS ====== */
    textarea {
      width: 100%;
      min-height: 180px;
      padding: 18px;
      border-radius: var(--radius);
      border: 2px solid var(--border);
      background: var(--secondary);
      font-family: 'JetBrains Mono', 'Consolas', monospace;
      font-size: 14px;
      color: var(--text);
      resize: vertical;
      transition: var(--transition);
      flex-grow: 1;
      box-sizing: border-box;
      max-width: 100%;
    }

    textarea:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .format-info {
      color: var(--text-light);
      font-size: 14px;
      margin: 12px 0 20px;
      padding: 12px 16px;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 8px;
      border-left: 3px solid var(--primary-light);
      word-break: break-word;
    }

    .count-display {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 16px;
      white-space: nowrap;
    }

    /* ====== BUTTONS ====== */
    button {
      padding: 12px 24px;
      border-radius: var(--radius);
      border: none;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      white-space: nowrap;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(30, 58, 138, 0.2);
    }

    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30, 58, 138, 0.3);
    }

    .btn-secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary-light);
    }

    .btn-secondary:hover {
      background: rgba(59, 130, 246, 0.05);
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 13px;
      border-radius: 8px;
    }

    .btn-icon {
      width: 20px;
      height: 20px;
    }

    /* ====== TABLES ====== */
    .table-container {
      overflow-x: auto;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      margin-top: 20px;
      width: 100%;
      max-width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      min-width: 100%;
      table-layout: fixed;
    }

    /* Atur lebar kolom untuk tabel preview */
    #adminTable th:nth-child(1),
    #adminTable td:nth-child(1) {
      width: 50px;
    }
    
    #adminTable th:nth-child(2),
    #adminTable td:nth-child(2) {
      width: 150px;
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    #adminTable th:nth-child(3),
    #adminTable td:nth-child(3) {
      width: 200px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    #adminTable th:nth-child(4),
    #adminTable td:nth-child(4) {
      width: 120px;
    }

    #qrisTable th:nth-child(1),
    #qrisTable td:nth-child(1) {
      width: 50px;
    }
    
    #qrisTable th:nth-child(2),
    #qrisTable td:nth-child(2) {
      width: 250px;
      max-width: 250px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    #qrisTable th:nth-child(3),
    #qrisTable td:nth-child(3) {
      width: 120px;
    }

    /* Tabel hasil pencocokan */
    #resultTable th:nth-child(1),
    #resultTable td:nth-child(1) {
      width: 180px;
      max-width: 180px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    #resultTable th:nth-child(2),
    #resultTable td:nth-child(2) {
      width: 140px;
    }
    
    #resultTable th:nth-child(3),
    #resultTable td:nth-child(3) {
      width: 120px;
      max-width: 120px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    #resultTable th:nth-child(4),
    #resultTable td:nth-child(4),
    #resultTable th:nth-child(5),
    #resultTable td:nth-child(5) {
      width: 120px;
    }
    
    #resultTable th:nth-child(6),
    #resultTable td:nth-child(6) {
      width: 200px;
      max-width: 200px;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      font-weight: 600;
      padding: 16px 12px;
      text-align: left;
      white-space: nowrap;
      position: sticky;
      top: 0;
    }

    th:first-child {
      border-top-left-radius: var(--radius);
    }

    th:last-child {
      border-top-right-radius: var(--radius);
    }

    td {
      padding: 14px 12px;
      border-bottom: 1px solid var(--border);
      vertical-align: top;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    tr:last-child td {
      border-bottom: none;
    }

    tr:hover td {
      background: rgba(59, 130, 246, 0.03);
    }

    /* ====== BADGES ====== */
    .badge {
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 700;
      display: inline-block;
      border: none;
      white-space: nowrap;
    }

    /* Warna badge untuk status di tabel */
    .badge-success {
      background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
      color: white;
    }

    .badge-warning {
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      color: white;
    }

    .badge-info {
      background: linear-gradient(135deg, #0ea5e9 0%, #38bdf8 100%);
      color: white;
    }

    .badge-danger {
      background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
      color: white;
    }

    /* ====== STATISTICS CARD ====== */
    /* Warna khusus untuk statistik card */
    .stat-item-mismatch {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left: 4px solid #ef4444;
    }
    
    .stat-item-pending-admin {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-left: 4px solid #ef4444;
    }
    
    .stat-item-pending-bayar {
      background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
      border-left: 4px solid #f59e0b;
    }
    
    .stat-item-terproses {
      background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      border-left: 4px solid #10b981;
    }
    
    .stat-item-tampil {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid #3b82f6;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px 20px;
      background: white;
      border-radius: var(--radius);
      min-width: 120px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .stat-value {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-light);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* ====== FILTERS & SEARCH ====== */
    .filters {
      display: flex;
      gap: 16px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
      padding: 20px;
      background: var(--secondary);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      width: 100%;
    }

    select, input[type="text"] {
      padding: 12px 16px;
      border-radius: var(--radius);
      border: 2px solid var(--border);
      background: white;
      color: var(--text);
      font-size: 14px;
      min-width: 200px;
      max-width: 100%;
      transition: var(--transition);
      box-sizing: border-box;
    }

    select:focus, input[type="text"]:focus {
      outline: none;
      border-color: var(--primary-light);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .search-container {
      position: relative;
      flex-grow: 1;
      min-width: 250px;
      max-width: 100%;
    }

    .search-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-light);
      pointer-events: none;
    }

    .search-container input {
      padding-left: 42px;
      width: 100%;
    }

    /* ====== RESULTS SECTION ====== */
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 20px;
      width: 100%;
    }

    .results-stats {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      width: 100%;
    }

    .copy-buttons {
      display: flex;
      gap: 12px;
      margin: 20px 0;
      flex-wrap: wrap;
      width: 100%;
    }

    /* ====== TOAST NOTIFICATION ====== */
    .toast {
      position: fixed;
      left: 24px;
      bottom: 24px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 16px 24px;
      border-radius: var(--radius);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 10px 25px rgba(30, 58, 138, 0.2);
      opacity: 0;
      transform: translateY(20px);
      transition: var(--transition);
      pointer-events: none;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: calc(100% - 48px);
    }

    .toast::before {
      content: '✓';
      background: white;
      color: var(--primary);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* ====== FOOTER ====== */
    .footer {
      text-align: center;
      padding: 24px;
      color: var(--text-light);
      font-size: 14px;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }

    /* ====== UTILITY CLASSES ====== */
    .spacer {
      height: 20px;
    }

    .muted {
      color: var(--text-light);
    }

    .text-right {
      text-align: right;
    }

    .text-center {
      text-align: center;
    }

    .flex {
      display: flex;
    }

    .align-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .gap-10 {
      gap: 10px;
    }

    .gap-16 {
      gap: 16px;
    }

    .gap-20 {
      gap: 20px;
    }

    .w-100 {
      width: 100%;
    }

    /* ====== SCROLLBAR STYLING ====== */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: var(--secondary);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, var(--primary-light) 0%, var(--accent) 100%);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }

    /* ====== RESPONSIVE ADJUSTMENTS ====== */
    @media (max-width: 768px) {
      .main-container {
        padding: 0 16px;
      }
      
      .card {
        padding: 20px;
      }
      
      .grid {
        gap: 16px;
      }
      
      .filters {
        flex-direction: column;
        align-items: stretch;
      }
      
      select, input[type="text"] {
        min-width: 100%;
      }
      
      .search-container {
        min-width: 100%;
      }
      
      .results-header {
        flex-direction: column;
      }
      
      .copy-buttons {
        flex-direction: column;
      }
      
      .copy-buttons button {
        width: 100%;
      }
      
      .stat-item {
        min-width: calc(50% - 8px);
      }
    }

    @media (max-width: 480px) {
      .header-container {
        padding: 20px 0;
      }
      
      .logo-container {
        flex-direction: column;
        text-align: center;
        gap: 10px;
      }
      
      .logo-title {
        font-size: 24px;
      }
      
      .intro-card h1 {
        font-size: 20px;
      }
      
      .card-title {
        font-size: 18px;
      }
      
      .stat-item {
        min-width: 100%;
      }
    }

    /* ==========================================================
       ===== UPDATE FIX TABEL + PERLEBAR (OVERRIDE TERAKHIR) =====
       ========================================================== */

    /* Perlebar container utama */
    .main-container,
    .header-content {
      max-width: 1400px !important;
    }

    /* Perbaiki tabel supaya tidak "kunci sempit" */
    .table-container {
      width: 100% !important;
      max-width: 100% !important;
      overflow-x: auto !important;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100% !important;
      min-width: 980px !important;
      table-layout: auto !important; /* override fixed */
    }

    th, td {
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Default cell boleh turun baris (biar tabel gak rusak) */
    td {
      white-space: normal !important;
      word-break: break-word;
    }

    /* Kolom ID/angka tetap nowrap biar rapi */
    #adminTable td:nth-child(2),
    #adminTable td:nth-child(3),
    #qrisTable td:nth-child(2),
    #resultTable td:nth-child(1),
    #resultTable td:nth-child(3),
    #adminTable td:nth-child(4),
    #qrisTable td:nth-child(3),
    #resultTable td:nth-child(4),
    #resultTable td:nth-child(5) {
      white-space: nowrap !important;
    }

    /* Lebar kolom baru yang lebih enak dibaca */
    #adminTable th:nth-child(1),
    #adminTable td:nth-child(1) { width: 60px !important; }

    #adminTable th:nth-child(2),
    #adminTable td:nth-child(2) { width: 180px !important; max-width: none !important; }

    #adminTable th:nth-child(3),
    #adminTable td:nth-child(3) { width: 320px !important; max-width: none !important; }

    #adminTable th:nth-child(4),
    #adminTable td:nth-child(4) { width: 140px !important; }

    #qrisTable th:nth-child(1),
    #qrisTable td:nth-child(1) { width: 60px !important; }

    #qrisTable th:nth-child(2),
    #qrisTable td:nth-child(2) { width: 420px !important; max-width: none !important; }

    #qrisTable th:nth-child(3),
    #qrisTable td:nth-child(3) { width: 140px !important; }

    #resultTable th:nth-child(1),
    #resultTable td:nth-child(1) { width: 320px !important; max-width: none !important; }

    #resultTable th:nth-child(2),
    #resultTable td:nth-child(2) { width: 170px !important; }

    #resultTable th:nth-child(3),
    #resultTable td:nth-child(3) { width: 220px !important; max-width: none !important; }

    #resultTable th:nth-child(4),
    #resultTable td:nth-child(4) { width: 150px !important; }

    #resultTable th:nth-child(5),
    #resultTable td:nth-child(5) { width: 150px !important; }

    /* Catatan jadi kolom fleksibel + boleh turun baris */
    #resultTable th:nth-child(6),
    #resultTable td:nth-child(6) {
      width: auto !important;
      min-width: 260px !important;
      max-width: none !important;
      white-space: normal !important;
    }

    /* Mobile tetap enak: tabel scroll horizontal */
    @media (max-width: 768px) {
      table { min-width: 980px !important; }
    }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Header dengan logo -->
  <div class="header-container">
    <div class="header-content">
      <div class="logo-container">
        <img src="https://cdn.areabermain.club/assets/cdn/az9/2025/10/08/20251008/e615919bf7952d738f21af8c12fed553/logo-hokijitu.png" alt="Hokijitu Logo" class="logo">
        <div class="logo-text">
          <h1 class="logo-title">Hokijitu</h1>
          <p class="logo-subtitle">Check Selisih Minera</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Konten utama -->
  <div class="main-container">
    <!-- Intro card -->
    <div class="intro-card">
      <h1>Check Selisih Minera HokiJitu</h1>
      <div class="key-info">
        <p>Note : <b>Data Minera ADMIN Di Kiri</b> <<.>> <b>Data Minera Di Kanan</b>.</p>
      </div>
    </div>

    <!-- Input sections -->
    <div class="grid">
      <!-- Panel Admin -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-user-cog btn-icon"></i> Panel Admin</h2>
          <button class="btn-secondary btn-small" id="btnClearAdmin" type="button">
            <i class="fas fa-trash-alt btn-icon"></i> Clear
          </button>
        </div>
        <div class="format-info">
          Format : <code>UserId > OrderId > Amount</code> 
        </div>
        <textarea id="adminText" placeholder="Tempel data Admin di sini..."></textarea>
        <div class="count-display">
          <i class="fas fa-list-ol btn-icon"></i>
          Terbaca: <span id="adminCount">0</span> baris
        </div>
      </div>

      <!-- Panel QRIS -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title"><i class="fas fa-qrcode btn-icon"></i> Panel MINERA</h2>
          <button class="btn-secondary btn-small" id="btnClearQris" type="button">
            <i class="fas fa-trash-alt btn-icon"></i> Clear
          </button>
        </div>
        <div class="format-info">
          Format : <code>reference_no > Amount</code>
        </div>
        <textarea id="qrisText" placeholder="Tempel data QRIS di sini..."></textarea>
        <div class="count-display">
          <i class="fas fa-list-ol btn-icon"></i>
          Terbaca: <span id="qrisCount">0</span> baris
        </div>
      </div>
    </div>

    <!-- Preview tables -->
    <div class="grid">
      <div class="card">
        <h2 class="card-title"><i class="fas fa-eye btn-icon"></i> Preview Admin (10 baris)</h2>
        <div class="table-container">
          <table id="adminTable">
            <thead>
              <tr>
                <th>#</th>
                <th>UserId</th>
                <th>OrderId</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="4" class="text-center muted">Belum ada data.</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h2 class="card-title"><i class="fas fa-eye btn-icon"></i> Preview QRIS (10 baris)</h2>
        <div class="table-container">
          <table id="qrisTable">
            <thead>
              <tr>
                <th>#</th>
                <th>reference_no</th>
                <th class="text-right">Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr><td colspan="3" class="text-center muted">Belum ada data.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Action buttons -->
    <div class="card">
      <div class="flex align-center justify-between gap-20" style="flex-wrap: wrap;">
        <div class="flex gap-10" style="flex-wrap: wrap;">
          <button id="btnConvert" class="btn-primary" disabled type="button">
            <i class="fas fa-sync-alt btn-icon"></i> Confirm
          </button>
          <button id="btnClearAll" class="btn-secondary" type="button">
            <i class="fas fa-broom btn-icon"></i> Clear All
          </button>
        </div>
        <div id="summary" class="muted" style="max-width: 100%; overflow: hidden; text-overflow: ellipsis;"></div>
      </div>
    </div>

    <!-- Results section -->
    <div class="card">
      <div class="results-header">
        <h2 class="card-title"><i class="fas fa-chart-bar btn-icon"></i> Hasil Pencocokan</h2>
        
        <div class="filters">
          <div style="min-width: 200px;">
            <label class="muted" for="filterStatus"><b>Filter Status:</b></label>
            <select id="filterStatus">
              <option value="ALL">Semua Status</option>
              <option value="MISMATCH_AMOUNT">Mismatch Amount</option>
              <option value="PENDING_ADMIN">Pending Admin</option>
              <option value="PENDING_BAYAR">Pending Bayar</option>
              <option value="TERPROSES">Terproses</option>
            </select>
          </div>
          
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input id="searchKey" type="text" placeholder="Cari key atau userId..." />
          </div>
        </div>
      </div>

      <!-- Statistics -->
      <div class="results-stats" id="resultsStats" style="display: none;">
        <div class="stat-item stat-item-mismatch">
          <span class="stat-value" id="statMismatch">0</span>
          <span class="stat-label">Mismatch</span>
        </div>
        <div class="stat-item stat-item-pending-admin">
          <span class="stat-value" id="statPendingAdmin">0</span>
          <span class="stat-label">Pending Admin</span>
        </div>
        <div class="stat-item stat-item-pending-bayar">
          <span class="stat-value" id="statPendingBayar">0</span>
          <span class="stat-label">Pending Bayar</span>
        </div>
        <div class="stat-item stat-item-terproses">
          <span class="stat-value" id="statTerproses">0</span>
          <span class="stat-label">Terproses</span>
        </div>
        <div class="stat-item stat-item-tampil">
          <span class="stat-value" id="statVisible">0</span>
          <span class="stat-label">Tampil</span>
        </div>
      </div>

      <!-- Copy buttons -->
      <div class="copy-buttons">
        <button id="btnCopyKeys" class="btn-secondary btn-small" type="button">
          <i class="fas fa-copy btn-icon"></i> Copy Key (Order/Ref)
        </button>
        <button id="btnCopyUsers" class="btn-secondary btn-small" type="button">
          <i class="fas fa-users btn-icon"></i> Copy Admin UserId
        </button>
        <button id="btnCopyPendingKeys" class="btn-secondary btn-small" type="button">
          <i class="fas fa-clock btn-icon"></i> Copy Key Pending (Admin+Bayar)
        </button>
        <div class="muted" style="margin-left: auto; white-space: nowrap;">
          Tampil: <b id="visibleCount">0</b> baris
        </div>
      </div>

      <!-- Results table -->
      <div class="table-container">
        <table id="resultTable">
          <thead>
            <tr>
              <th>Key (Order/Ref)</th>
              <th>Status</th>
              <th>Admin UserId</th>
              <th class="text-right">Admin Amount</th>
              <th class="text-right">QRIS Amount</th>
              <th>Catatan</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="6" class="text-center muted">Klik Confirm.</td></tr>
          </tbody>
        </table>
      </div>

      <div class="spacer"></div>
      <div class="format-info">
        <i class="fas fa-info-circle btn-icon"></i>
        Catatan: jika ada ID yang muncul lebih dari sekali (double), Otomatis akan mengambil data terakhir.
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>© 2023 Hokijitu All rights reserved.</p>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast">Tersalin</div>

  <!-- JAVASCRIPT -->
  <script>
    function cleanAmountToInt(value){
      const cleaned = String(value).replace(/[^\d]/g,'');
      return cleaned ? parseInt(cleaned,10) : 0;
    }
    function normalizeKey(key){ return String(key||'').trim(); }
    function formatIDR(n){
      if(!Number.isFinite(n)) return '-';
      return new Intl.NumberFormat('id-ID').format(n);
    }
    function escapeHtml(s){
      return String(s ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }
    function toast(msg){
      const el = document.getElementById('toast');
      el.textContent = msg;
      el.classList.add('show');
      setTimeout(()=> el.classList.remove('show'), 1200);
    }

    // Admin: UserId > OrderId > Amount  (atau whitespace)
    function parseAdmin(text){
      const lines = String(text||'').split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const rows = [];
      lines.forEach((line, idx)=>{
        const gt = line.split('>').map(p=>p.trim()).filter(Boolean);
        let userId='', orderId='', amountStr='';
        if(gt.length >= 3){
          userId = gt[0];
          orderId = gt[1];
          amountStr = gt.slice(2).join(' ');
        } else {
          const parts = line.split(/\s+/).filter(Boolean);
          if(parts.length >= 3){
            userId = parts[0];
            orderId = parts[1];
            amountStr = parts.slice(2).join(' ');
          } else return;
        }
        rows.push({
          lineNo: idx+1,
          userId,
          orderId: normalizeKey(orderId),
          amount: cleanAmountToInt(amountStr),
          raw: line
        });
      });
      return rows;
    }

    // QRIS: reference_no > Amount (atau whitespace)
    function parseQris(text){
      const lines = String(text||'').split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
      const rows = [];
      lines.forEach((line, idx)=>{
        const gt = line.split('>').map(p=>p.trim()).filter(Boolean);
        let referenceNo='', amountStr='';
        if(gt.length >= 2){
          referenceNo = gt[0];
          amountStr = gt.slice(1).join(' ');
        } else {
          const parts = line.split(/\s+/).filter(Boolean);
          if(parts.length >= 2){
            referenceNo = parts[0];
            amountStr = parts.slice(1).join(' ');
          } else return;
        }
        rows.push({
          lineNo: idx+1,
          referenceNo: normalizeKey(referenceNo),
          amount: cleanAmountToInt(amountStr),
          raw: line
        });
      });
      return rows;
    }

    // Badge status
    function badge(status){
      let cls = 'badge ';
      if(status === 'TERPROSES') {
        cls += 'badge-success';
      } else if(status === 'PENDING_ADMIN') {
        cls += 'badge-danger';
      } else if(status === 'PENDING_BAYAR') {
        cls += 'badge-warning';
      } else {
        cls += 'badge-danger';
      }
      return '<span class="'+cls+'">'+status+'</span>';
    }

    function reconcile(adminRows, qrisRows){
      const adminMap = new Map();
      adminRows.forEach(r => adminMap.set(r.orderId, r));
      const qrisMap = new Map();
      qrisRows.forEach(r => qrisMap.set(r.referenceNo, r));

      const allKeys = new Set([...adminMap.keys(), ...qrisMap.keys()]);
      const results = [];

      allKeys.forEach(key=>{
        const a = adminMap.get(key);
        const q = qrisMap.get(key);
        let status;
        if(a && q){
          status = (a.amount === q.amount) ? 'TERPROSES' : 'MISMATCH_AMOUNT';
        } else if(a && !q){
          status = 'PENDING_BAYAR';
        } else {
          status = 'PENDING_ADMIN';
        }
        results.push({key, admin:a, qris:q, status});
      });

      const rank = { 'MISMATCH_AMOUNT':1, 'PENDING_ADMIN':2, 'PENDING_BAYAR':3, 'TERPROSES':4 };
      results.sort((x,y)=> (rank[x.status]-rank[y.status]) || x.key.localeCompare(y.key));
      return results;
    }

    function renderPreviewAdmin(rows){
      const tbody = document.querySelector('#adminTable tbody');
      if(!rows.length){
        tbody.innerHTML = '<tr><td colspan="4" class="text-center muted">Belum ada data.</td></tr>';
        return;
      }
      const show = rows.slice(0,10);
      tbody.innerHTML = show.map(r=>`
        <tr>
          <td>${r.lineNo}</td>
          <td title="${escapeHtml(r.userId)}">${escapeHtml(r.userId)}</td>
          <td title="${escapeHtml(r.orderId)}"><code>${escapeHtml(r.orderId)}</code></td>
          <td class="text-right"><b>${formatIDR(r.amount)}</b></td>
        </tr>
      `).join('');
    }

    function renderPreviewQris(rows){
      const tbody = document.querySelector('#qrisTable tbody');
      if(!rows.length){
        tbody.innerHTML = '<tr><td colspan="3" class="text-center muted">Belum ada data.</td></tr>';
        return;
      }
      const show = rows.slice(0,10);
      tbody.innerHTML = show.map(r=>`
        <tr>
          <td>${r.lineNo}</td>
          <td title="${escapeHtml(r.referenceNo)}"><code>${escapeHtml(r.referenceNo)}</code></td>
          <td class="text-right"><b>${formatIDR(r.amount)}</b></td>
        </tr>
      `).join('');
    }

    function getNote(status){
      if(status === 'TERPROSES') return '✅ Cocok';
      if(status === 'PENDING_ADMIN') return '⚠️ Ada di QRIS, belum ada di Admin';
      if(status === 'PENDING_BAYAR') return '⏳ Ada di Admin, belum ada di QRIS';
      return '❌ ID cocok, nominal beda';
    }

    // ====== State hasil ======
    let LAST_RESULTS = [];
    let LAST_COUNTS = { TERPROSES:0, PENDING_ADMIN:0, PENDING_BAYAR:0, MISMATCH_AMOUNT:0 };

    function applyFilterAndSearch(results){
      const statusFilter = document.getElementById('filterStatus').value;
      const q = document.getElementById('searchKey').value.trim().toLowerCase();

      return results.filter(r=>{
        if(statusFilter !== 'ALL' && r.status !== statusFilter) return false;
        if(!q) return true;
        const key = (r.key || '').toLowerCase();
        const uid = (r.admin?.userId || '').toLowerCase();
        return key.includes(q) || uid.includes(q);
      });
    }

    function renderResult(results){
      const tbody = document.querySelector('#resultTable tbody');
      const visible = applyFilterAndSearch(results);
      document.getElementById('visibleCount').textContent = visible.length;
      
      document.getElementById('statVisible').textContent = visible.length;
      document.getElementById('resultsStats').style.display = 'flex';

      if(!visible.length){
        tbody.innerHTML = '<tr><td colspan="6" class="text-center muted">Tidak ada data sesuai filter / pencarian.</td></tr>';
        return;
      }

      tbody.innerHTML = visible.map(r=>{
        const note = getNote(r.status);
        return `
          <tr>
            <td title="${escapeHtml(r.key)}"><b><code>${escapeHtml(r.key)}</code></b></td>
            <td>${badge(r.status)}</td>
            <td title="${r.admin ? escapeHtml(r.admin.userId) : ''}">${r.admin ? escapeHtml(r.admin.userId) : '-'}</td>
            <td class="text-right"><b>${r.admin ? formatIDR(r.admin.amount) : '-'}</b></td>
            <td class="text-right"><b>${r.qris ? formatIDR(r.qris.amount) : '-'}</b></td>
            <td>${escapeHtml(note)}</td>
          </tr>
        `;
      }).join('');
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        toast('Tersalin ke clipboard ✅');
      }catch(e){
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
        toast('Tersalin (fallback) ✅');
      }
    }

    function collectVisibleKeys(){
      const visible = applyFilterAndSearch(LAST_RESULTS);
      return visible.map(r=>r.key).filter(Boolean);
    }

    function collectVisibleAdminUserIds(){
      const visible = applyFilterAndSearch(LAST_RESULTS);
      return visible.map(r=>r.admin?.userId).filter(Boolean);
    }

    function collectPendingKeys(){
      const visible = applyFilterAndSearch(LAST_RESULTS);
      return visible
        .filter(r => r.status === 'PENDING_ADMIN' || r.status === 'PENDING_BAYAR')
        .map(r => r.key)
        .filter(Boolean);
    }

    // ====== Wire UI ======
    const adminTextEl = document.getElementById('adminText');
    const qrisTextEl = document.getElementById('qrisText');
    const adminCountEl = document.getElementById('adminCount');
    const qrisCountEl = document.getElementById('qrisCount');
    const btn = document.getElementById('btnConvert');
    const summaryEl = document.getElementById('summary');

    function resetResultsView(){
      LAST_RESULTS = [];
      LAST_COUNTS = { TERPROSES:0, PENDING_ADMIN:0, PENDING_BAYAR:0, MISMATCH_AMOUNT:0 };
      document.getElementById('visibleCount').textContent = '0';
      document.getElementById('resultsStats').style.display = 'none';
      summaryEl.textContent = '';
      const resBody = document.querySelector('#resultTable tbody');
      resBody.innerHTML = '<tr><td colspan="6" class="text-center muted">Klik "Convert / Cocokkan" untuk menampilkan hasil.</td></tr>';
    }

    function refreshPreviews(){
      const adminRows = parseAdmin(adminTextEl.value);
      const qrisRows = parseQris(qrisTextEl.value);

      adminCountEl.textContent = adminRows.length;
      qrisCountEl.textContent = qrisRows.length;

      renderPreviewAdmin(adminRows);
      renderPreviewQris(qrisRows);

      btn.disabled = (adminRows.length === 0 && qrisRows.length === 0);
      resetResultsView();
    }

    adminTextEl.addEventListener('input', refreshPreviews);
    qrisTextEl.addEventListener('input', refreshPreviews);

    document.getElementById('btnClearAdmin').addEventListener('click', ()=>{
      adminTextEl.value = '';
      refreshPreviews();
      toast('Data Admin berhasil dihapus');
    });

    document.getElementById('btnClearQris').addEventListener('click', ()=>{
      qrisTextEl.value = '';
      refreshPreviews();
      toast('Data QRIS berhasil dihapus');
    });

    document.getElementById('btnClearAll').addEventListener('click', ()=>{
      adminTextEl.value = '';
      qrisTextEl.value = '';
      document.getElementById('filterStatus').value = 'ALL';
      document.getElementById('searchKey').value = '';
      refreshPreviews();
      toast('Semua data berhasil dihapus');
    });

    btn.addEventListener('click', ()=>{
      const adminRows = parseAdmin(adminTextEl.value);
      const qrisRows = parseQris(qrisTextEl.value);
      const results = reconcile(adminRows, qrisRows);

      const counts = { TERPROSES:0, PENDING_ADMIN:0, PENDING_BAYAR:0, MISMATCH_AMOUNT:0 };
      results.forEach(r=> counts[r.status]++);
      LAST_RESULTS = results;
      LAST_COUNTS = counts;

      document.getElementById('statMismatch').textContent = counts.MISMATCH_AMOUNT;
      document.getElementById('statPendingAdmin').textContent = counts.PENDING_ADMIN;
      document.getElementById('statPendingBayar').textContent = counts.PENDING_BAYAR;
      document.getElementById('statTerproses').textContent = counts.TERPROSES;

      document.getElementById('statMismatch').style.color = '#ef4444';
      document.getElementById('statPendingAdmin').style.color = '#ef4444';
      document.getElementById('statPendingBayar').style.color = '#f59e0b';
      document.getElementById('statTerproses').style.color = '#10b981';
      document.getElementById('statVisible').style.color = '#3b82f6';

      summaryEl.innerHTML = `
        <div class="count-display">
          <i class="fas fa-chart-pie btn-icon"></i>
          Hasil: <b>${results.length}</b> transaksi ditemukan
          (${counts.MISMATCH_AMOUNT} mismatch, 
          ${counts.PENDING_ADMIN} pending admin, 
          ${counts.PENDING_BAYAR} pending bayar, 
          ${counts.TERPROSES} terproses)
        </div>
      `;

      renderResult(LAST_RESULTS);
      toast('Hasil pencocokan berhasil diperbarui');
    });

    document.getElementById('filterStatus').addEventListener('change', ()=>{
      if(!LAST_RESULTS.length) return;
      renderResult(LAST_RESULTS);
    });

    document.getElementById('searchKey').addEventListener('input', ()=>{
      if(!LAST_RESULTS.length) return;
      renderResult(LAST_RESULTS);
    });

    document.getElementById('btnCopyKeys').addEventListener('click', async ()=>{
      if(!LAST_RESULTS.length){ toast('Belum ada hasil'); return; }
      const keys = collectVisibleKeys();
      if(!keys.length){ toast('Tidak ada data untuk di-copy'); return; }
      await copyToClipboard(keys.join('\n'));
    });

    document.getElementById('btnCopyUsers').addEventListener('click', async ()=>{
      if(!LAST_RESULTS.length){ toast('Belum ada hasil'); return; }
      const users = collectVisibleAdminUserIds();
      if(!users.length){ toast('Tidak ada UserId untuk di-copy'); return; }
      const uniq = Array.from(new Set(users));
      await copyToClipboard(uniq.join('\n'));
    });

    document.getElementById('btnCopyPendingKeys').addEventListener('click', async ()=>{
      if(!LAST_RESULTS.length){ toast('Belum ada hasil'); return; }
      const keys = collectPendingKeys();
      if(!keys.length){ toast('Tidak ada pending untuk di-copy'); return; }
      await copyToClipboard(keys.join('\n'));
    });

    refreshPreviews();
  </script>
</body>
</html>

